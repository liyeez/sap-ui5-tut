const cds = require('../../cds')
const deleet = require('./delete')
const insert = require('./insert')
const select = require('./select')
const update = require('./update')

module.exports = (cqn, target, type) => {
  const { remote_new_parser: cqn2odata } = cds.env.features
  if (cqn2odata) {
    if (!cds.odata) cds.odata = require('../../odata')
    return cds.odata.parse.cqn(cqn, type)
  }

  if (cqn.SELECT) return select(cqn, target, type)
  if (cqn.INSERT) return insert(cqn, target, type)
  if (cqn.UPDATE) return update(cqn, target, type)
  if (cqn.DELETE) return deleet(cqn, target, type)

  throw new Error('Unknown CQN object cannot be translated to URL: ' + JSON.stringify(cqn))
}
